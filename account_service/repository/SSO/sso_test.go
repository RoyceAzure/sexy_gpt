package sso

import (
	"context"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestVertifyGoogleSSOIDToken(t *testing.T) {

	testCases := []struct {
		name          string
		token         string
		checkResponse func(t *testing.T, res *GoogleSSO, err error)
	}{
		{
			name:  "ok",
			token: "eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..YlJfZqn8lghGEmYp.vZu7I5-UVhIwUkGDFvUx3qjjdZd7UOXOpvjfV2YB6GD1RmHPfLUEwkfEKPxWq8HVlUJx6CSJUC28OgAoN1ed2--nYF7y--q1Tt9H6Sz7uCbFOyVMwUtNqMhjTv6FVJ06LbOdvyYWrEft0J8hkURFtWsVyyVaM3wCXBNNb9_69Z4Pk5lm_Dok34Y3V0tQbJ92vaQ7oebxtchx6v3oC6QTHETlk-3J11HJzYe0taJzCqWHwzLJFGgo5r0rGdSS43Wp2PicgV1YrAEg4R42HQRgu0wIg_h7iF7hgoG4NO58rH_BU9cIDEKfGGTB4_Vm-5CXM7NbwZ8k-p7NToO7ynrNPGCCPUaig5sh80KpDO9RAqM1tspq7phzuTdHwQTDCdKehQSHPVJJ-y9-O4GYWYl9dKJ4l5Spt6Lqg9WnXK32PRqFtUXxI5sIMGiaOi_8YEEB4vbMaOP3yDsNWqLc3fJPzqIttP_b-tK_Bweg0dcPnA8_2-5B4rqbfpBB4bfRYJ0RDJBd-B6kVEKKJOpg76dZOtXW-Gejr_wTROk4fbgRxMUy7hzwhhRri6A_0gs2yNxHvqHKb1JIsd9TF3iLfmL5JnG9IKTgoTBFoV2-7AcJA6bkeClGmQJniDoyZfX1NLKx6zXEEJ0dOgem_Ny1Oo6d_MWSkljfOCR4nuU99bSzqY3wFZXlyEyIBGiZejMjYA0PeOqpyHG5ikVOgSPundcRDOn3cSua5Tbwah4y_cT7pVoRnoWbJTgWiZFQRF6pIz9_X-mYoWde36ERELuc562JVYR-W981vx3Yd73it_BIL4VNT4FG8hCzi291GgC4lrtuI2uXSaXm-a8IZ0kfahNHftkPFxwbfcKzk_lI-y-FOfzTG1koOgzaF5QjdcYTY7Wf5EDl16GVUPbqLdpgRsitM00h5dqwWAXjVd2Gfw4dkR_P9FJ9hxIyDpvUzZp9fcjQoQzRd4g-CLh21IKiTpPIbCsjqsDP30AuRO9huL_UtnVrWZt0NDylp6giDERsvwTwLsYPsWR1PFHnu0Ah-JCGB85SbFBxM1EWpnkPIkp-QgSjkLl-YJIildOWV-uPJj3qcgIv85i0SbOqEuGF26MWhiyCBWMWbxclplmoWwnHEPR9zJO9WPnB1GyaM6FWkB-KOyd7fsRX0y6yd1YcD_dAiBNRP3xdGQz5ND-eeUvGqN192XB43vuMD2Ay28M4cd1McnS6-WCMVaWmKS_HA_rxiH8BtdCiXDKVKTyR5hq-G_HmyN-MeGSKkkn8kBGe1Bzd5BhcO8NnDCOa47jC_bCFYg7tA7_f1rmGbYjxfNs3MIDfa8WA5oOs_sgvIozsjIpeyHu6c8G_aM9VPI7ORYoqd6KSouOhoAzq5CFXB8Huods5Un_V7XIauIpdw0bK7O5IgOdb--tyhJxbU_WStJ2VXZIx6Y0KK_794RHNzi6upcQRfwREGXsQ_GfEzfAO9w-P3O-q06cKgcyYooFVSCvlPa2ifvhtmLix3V17bxzKRVkApw1WWnW2MhZCEgqtGQWGwch-Gxuu7xB_E4-tLxJBlga0AmiGWC2VlPpZ4ldSoCns9nhNK_u5h40AO01YVEfmA8DKrmNUHttn5UYSiFt2qVJygxfj4PkVzIw9S3UekeSDCB8no85PkMNjOasZovCvp17APB0fhJnQi9xNrfwvl06S4ER5GSmL80Llk8by-2HMTF-5A6nxjyhTrqNoFX_H4bWNue0zZhjmyZzLV_Pecl4xk_KWj5St47GVsstiVHi2__UfR7JwwcO-KQhBlgbqoKZ-8H10Bfzx4mRUVL1lTlZb5MKu4qDWGKBpZiflDro-wM4rLGhc-BI1ZGpMzfST4jEJbWwD1OvA0IZbnKD3xHUD0eUzYqxQJQjxAUYDmmUZC8e8ENaMF82RcBYNf4-Ybv5C7Kex9px88l_oVYxkYh2osGjRxHSBfUCwRR9YTpFMlau9kX25swjaJUIavCX0Tvie5Zag5VpduirJ-4p9Y8uKJ8kjTLVW6Amd0ZjFkgUFf6cCfYPr2zouDcOgBd1d3ITmLZKd4aQZx4YxJVYuRzlsRFeY0F5q7iPK0ikGyyXB5-hliXwZRSMUtsQG0MXR28gUj8JLbgZN7lHnxzMCd9KSsDmW7dcdklKK4uEM8oNlckCooFPUQiSWR9xPFG3vMHDlOW1mUrpSgO8--k1os6V2y4wdufAt7tyAJPVz0ZRZZpM.B90nmWAt7YZVFJQSS2fjKw",
			checkResponse: func(t *testing.T, res *GoogleSSO, err error) {
				require.Nil(t, err)
				require.NotNil(t, res)
			},
		},
		{
			name:  "invalid format",
			token: "e..YlJfZqn8lghGEmYp.vZu7I5-UVhIwUkGDFvUx3qjjdZd7UOXOpvjfV2YB6GD1RmHPfLUEwkfEKPxWq8HVlUJx6CSJUC28OgAoN1ed2--nYF7y--q1Tt9H6Sz7uCbFOyVMwUtNqMhjTv6FVJ06LbOdvyYWrEft0J8hkURFtWsVyyVaM3wCXBNNb9_69Z4Pk5lm_Dok34Y3V0tQbJ92vaQ7oebxtchx6v3oC6QTHETlk-3J11HJzYe0taJzCqWHwzLJFGgo5r0rGdSS43Wp2PicgV1YrAEg4R42HQRgu0wIg_h7iF7hgoG4NO58rH_BU9cIDEKfGGTB4_Vm-5CXM7NbwZ8k-p7NToO7ynrNPGCCPUaig5sh80KpDO9RAqM1tspq7phzuTdHwQTDCdKehQSHPVJJ-y9-O4GYWYl9dKJ4l5Spt6Lqg9WnXK32PRqFtUXxI5sIMGiaOi_8YEEB4vbMaOP3yDsNWqLc3fJPzqIttP_b-tK_Bweg0dcPnA8_2-5B4rqbfpBB4bfRYJ0RDJBd-B6kVEKKJOpg76dZOtXW-Gejr_wTROk4fbgRxMUy7hzwhhRri6A_0gs2yNxHvqHKb1JIsd9TF3iLfmL5JnG9IKTgoTBFoV2-7AcJA6bkeClGmQJniDoyZfX1NLKx6zXEEJ0dOgem_Ny1Oo6d_MWSkljfOCR4nuU99bSzqY3wFZXlyEyIBGiZejMjYA0PeOqpyHG5ikVOgSPundcRDOn3cSua5Tbwah4y_cT7pVoRnoWbJTgWiZFQRF6pIz9_X-mYoWde36ERELuc562JVYR-W981vx3Yd73it_BIL4VNT4FG8hCzi291GgC4lrtuI2uXSaXm-a8IZ0kfahNHftkPFxwbfcKzk_lI-y-FOfzTG1koOgzaF5QjdcYTY7Wf5EDl16GVUPbqLdpgRsitM00h5dqwWAXjVd2Gfw4dkR_P9FJ9hxIyDpvUzZp9fcjQoQzRd4g-CLh21IKiTpPIbCsjqsDP30AuRO9huL_UtnVrWZt0NDylp6giDERsvwTwLsYPsWR1PFHnu0Ah-JCGB85SbFBxM1EWpnkPIkp-QgSjkLl-YJIildOWV-uPJj3qcgIv85i0SbOqEuGF26MWhiyCBWMWbxclplmoWwnHEPR9zJO9WPnB1GyaM6FWkB-KOyd7fsRX0y6yd1YcD_dAiBNRP3xdGQz5ND-eeUvGqN192XB43vuMD2Ay28M4cd1McnS6-WCMVaWmKS_HA_rxiH8BtdCiXDKVKTyR5hq-G_HmyN-MeGSKkkn8kBGe1Bzd5BhcO8NnDCOa47jC_bCFYg7tA7_f1rmGbYjxfNs3MIDfa8WA5oOs_sgvIozsjIpeyHu6c8G_aM9VPI7ORYoqd6KSouOhoAzq5CFXB8Huods5Un_V7XIauIpdw0bK7O5IgOdb--tyhJxbU_WStJ2VXZIx6Y0KK_794RHNzi6upcQRfwREGXsQ_GfEzfAO9w-P3O-q06cKgcyYooFVSCvlPa2ifvhtmLix3V17bxzKRVkApw1WWnW2MhZCEgqtGQWGwch-Gxuu7xB_E4-tLxJBlga0AmiGWC2VlPpZ4ldSoCns9nhNK_u5h40AO01YVEfmA8DKrmNUHttn5UYSiFt2qVJygxfj4PkVzIw9S3UekeSDCB8no85PkMNjOasZovCvp17APB0fhJnQi9xNrfwvl06S4ER5GSmL80Llk8by-2HMTF-5A6nxjyhTrqNoFX_H4bWNue0zZhjmyZzLV_Pecl4xk_KWj5St47GVsstiVHi2__UfR7JwwcO-KQhBlgbqoKZ-8H10Bfzx4mRUVL1lTlZb5MKu4qDWGKBpZiflDro-wM4rLGhc-BI1ZGpMzfST4jEJbWwD1OvA0IZbnKD3xHUD0eUzYqxQJQjxAUYDmmUZC8e8ENaMF82RcBYNf4-Ybv5C7Kex9px88l_oVYxkYh2osGjRxHSBfUCwRR9YTpFMlau9kX25swjaJUIavCX0Tvie5Zag5VpduirJ-4p9Y8uKJ8kjTLVW6Amd0ZjFkgUFf6cCfYPr2zouDcOgBd1d3ITmLZKd4aQZx4YxJVYuRzlsRFeY0F5q7iPK0ikGyyXB5-hliXwZRSMUtsQG0MXR28gUj8JLbgZN7lHnxzMCd9KSsDmW7dcdklKK4uEM8oNlckCooFPUQiSWR9xPFG3vMHDlOW1mUrpSgO8--k1os6V2y4wdufAt7tyAJPVz0ZRZZpM.B90nmWAt7YZVFJQSS2fjKw",
			checkResponse: func(t *testing.T, res *GoogleSSO, err error) {
				require.NotNil(t, err)
				require.Empty(t, res)
			},
		},
		{
			name:  "empty token",
			token: "",
			checkResponse: func(t *testing.T, res *GoogleSSO, err error) {
				require.NotNil(t, err)
				require.Empty(t, res)
			},
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			res, err := VertifyGoogleSSOIDToken(context.Background(), tc.token, "982d1d7a9bfa3e9214f27d569ae518e6")
			tc.checkResponse(t, res, err)
		})
	}
}
